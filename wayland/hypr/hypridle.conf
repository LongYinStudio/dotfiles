# ~/.config/hypr/hypridle.conf
# ----------------------------
# Hyprland ç©ºé—²è¡Œä¸ºç®¡ç†å·¥å…· 
# ----------------------------

# ----------------------
# å¸¸è§„è®¾ç½®
# ----------------------
general {
  lock_cmd = "hyprlock"                  # é”å±å‘½ä»¤ï¼ˆéœ€å®‰è£… hyprlockï¼‰
  unlock_cmd = "notify-send 'ğŸ”“ å·²è§£é”'"   # ç”¨æˆ·æ¢å¤æ“ä½œæ—¶çš„æç¤º
  before_sleep_cmd = "loginctl lock-session"  # ç³»ç»Ÿä¼‘çœ å‰å¼ºåˆ¶é”å±
  ignore_dbus_inhibit = false            # æ˜¯å¦å¿½ç•¥åº”ç”¨é˜»æ­¢ä¼‘çœ ï¼ˆå¦‚æ’­æ”¾è§†é¢‘æ—¶ï¼‰
}

# ----------------------
# åˆ†é˜¶æ®µé…ç½®
# ----------------------

# é˜¶æ®µ 1: ç©ºé—² 3 åˆ†é’Ÿ - é™ä½äº®åº¦å¹¶æš‚åœåª’ä½“
listener {
  timeout = 180  # 3 åˆ†é’Ÿ (å•ä½: ç§’)
  on-timeout = "
    brightnessctl -q set 30% &&           # äº®åº¦è°ƒè‡³ 30%
    playerctl pause &&                    # æš‚åœæ‰€æœ‰åª’ä½“æ’­æ”¾
    notify-send 'ğŸ’¤ è¿›å…¥èŠ‚èƒ½æ¨¡å¼' --icon=battery-saver-symbolic
  "
  on-resume = "
    brightnessctl -q set 100% &&          # æ¢å¤äº®åº¦
    notify-send 'âš¡ æ¢å¤æ´»åŠ¨' --icon=computer-symbolic
  "
}

# é˜¶æ®µ 2: ç©ºé—² 5 åˆ†é’Ÿ - å…³é—­æ˜¾ç¤ºå™¨
listener {
  timeout = 300
  on-timeout = "
    if hyprctl monitors | grep -q HDMI-A-1; then
      hyprctl dispatch dpms off HDMI-A-1  # å…³é—­å¤–æ¥æ˜¾ç¤ºå™¨ï¼ˆæŒ‰åç§°æŒ‡å®šï¼‰
    fi
    hyprctl dispatch dpms off eDP-1       # å…³é—­ç¬”è®°æœ¬å†…ç½®å±å¹•
  "
  on-resume = "hyprctl dispatch dpms on"  # ç»Ÿä¸€å”¤é†’æ‰€æœ‰æ˜¾ç¤ºå™¨
}

# é˜¶æ®µ 3: ç©ºé—² 10 åˆ†é’Ÿ - é”å±
listener {
  timeout = 600
  on-timeout = "hyprlock --immediate"     # ç«‹å³é”å±ï¼ˆè·³è¿‡åŠ¨ç”»ï¼‰
}

# é˜¶æ®µ 4: ç©ºé—² 30 åˆ†é’Ÿ - æŒ‚èµ·ç³»ç»Ÿï¼ˆä»…ç”µæ± æ¨¡å¼ï¼‰
listener {
  timeout = 1800
  on-timeout = bash -c '                  # ä½¿ç”¨ bash è„šæœ¬åˆ¤æ–­ç”µæºçŠ¶æ€
    if [[ $(cat /sys/class/power_supply/BAT0/status) == "Discharging" ]]; then
      systemctl suspend && 
      notify-send 'ğŸ”‹ å·²æŒ‚èµ·ï¼ˆç”µæ± æ¨¡å¼ï¼‰'
    else
      notify-send 'ğŸ”Œ ä¿æŒå”¤é†’ï¼ˆç”µæºé€‚é…å™¨æ¨¡å¼ï¼‰'
    fi
  '
}

# ----------------------
# é«˜çº§é…ç½®
# ----------------------

# æ¸¸æˆ/å…¨å±æ—¶ç¦ç”¨ç©ºé—²æ“ä½œ
listener {
  timeout = 1  # æ¯ 1 ç§’æ£€æŸ¥ä¸€æ¬¡
  on-timeout = bash -c '
    active_window=$(hyprctl activewindow -j | jq -r ".class")
    if [[ $active_window =~ "steam"|"gamescope" ]]; then
      hypridle --pause                                 # æš‚åœ hypridle
      notify-send 'ğŸ® æ¸¸æˆæ¨¡å¼' 'å·²ç¦ç”¨è‡ªåŠ¨é”å±å’Œä¼‘çœ '
    else
      hypridle --resume                                # æ¢å¤ hypridle
    fi
  '
}

# é”™è¯¯å¤„ç†ï¼ˆæ—¥å¿—è®°å½•ï¼‰
listener {
  timeout = 3600  # æ¯å°æ—¶æ¸…ç†ä¸€æ¬¡æ—¥å¿—
  on-timeout = "
    journalctl -u hypridle --since '1 hour ago' > ~/.hypridle.log &&
    echo '[$(date)] æ—¥å¿—å·²å½’æ¡£' >> ~/.hypridle.log
  "
}

# æ‰‹åŠ¨è§¦å‘ç©ºé—²æ“ä½œï¼ˆæµ‹è¯•ç”¨ï¼‰
# hyprctl dispatch fakeidle  # æ¨¡æ‹Ÿè¿›å…¥ç©ºé—²çŠ¶æ€
# hyprctl dispatch resume    # æ¨¡æ‹Ÿç”¨æˆ·æ´»åŠ¨æ¢å¤
# æŸ¥çœ‹å®æ—¶æ—¥å¿—
# tail -f ~/.hypridle.log
